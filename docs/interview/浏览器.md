# 浏览器

## 浏览器内核

- 浏览器内核主要分为两部分：渲染引擎和 JS 引擎

  - 渲染引擎用于获取 html、css 和图片
  - JS 引擎用于解析执行 JavaScript

  以下为常见浏览器内核：

  | 浏览器  | 内核                        | CSS 前缀           |
  | ------- | --------------------------- | ----------------- |
  | IE/Edge | Trident 内核                 | -ms-              |
  | Firefox | Gecko 内核                   | -moz-             |
  | Safari  | Webkit 内核                  | -webkit-          |
  | Chrome  | Blink 内核（原 webkit 内核） | -webkit-          |
  | Opera   | Blink 内核（原 presto 内核） | -webkit（原 -o-） |

## 浏览器缓存

- 强缓存
  不会向服务器发送请求，直接从缓存中读取资源
- 协商缓存
  强缓存失效后，浏览器携带缓存标示向服务器发起请求，由服务器决定是否需要使用缓存

## 浏览器安全

### XSS 攻击

XSS 攻击是指**跨站脚本攻击**。通过注入恶意代码来攻击目标网站，使之在用户的浏览器上运行，从而盗取用户的信息。

XSS 攻击的**本质**是因为**网站没有对恶意代码进行过滤**，与正常的代码混合在一起了，浏览器没有办法分辨哪些脚本是可信的，从而导致了恶意代码的执行。

XSS 攻击可分为存储型、反射型和 DOM 型：

- 存储型：通过将恶意代码存储在服务器上
- 反射型：通过 URL 传参的方式来攻击
- DOM 型：通过插入恶意 HTML 代码

如何对 XSS 攻击进行防范：

- 转义字符。对用户输入进行充分转义。
- CSP 安全内容策略。建立白名单，告诉浏览器哪些外部资源可以加载和执行。

### CSRF 攻击

CSRF 攻击是指**跨站请求伪造攻击**。攻击者诱导用户进入一个第三方网站，然后该网站向被攻击网站发送跨站请求。如果用户在被攻击网站中保存了登录状态，那么攻击者就可以利用这个登录状态，绕过后台的用户验证，冒充用户向服务器执行一些操作。

CSRF 攻击的**本质**是**利用 cookie 会在同源请求中携带发送给服务器的特点，以此来实现用户的冒充。**

CSRF 攻击可分为 GET 型、POST 型和链接类型：

- GET 类型的 CSRF 攻击，比如在网站中的一个 img 标签里构建一个请求，当用户打开这个网站的时候就会自动发起提交。
- POST 类型的 CSRF 攻击，比如构建一个表单，然后隐藏它，当用户进入页面时，自动提交这个表单。
- 链接类型的 CSRF 攻击，比如在 a 标签的 href 属性里构建一个请求，然后诱导用户去点击。

如何对 CSRF 攻击进行防范：

- 进行同源检测
- 对 Cookie 进行双重验证
- 使用 CSRF Token 进行验证
- 在设置 Cookie 属性的时候设置 Samesite，限制 Cookie 不能作为被第三方使用

### 中间人攻击

中间⼈攻击是指**攻击者与通讯的两端分别创建独立的联系，并交换其所收到的数据，使通讯的两端认为他们正在通过⼀个私密的连接与对方直接对话，但事实上整个会话都被攻击者完全控制**。 在中间⼈攻击中，攻击者可以拦截通讯双方的通话并插⼊新的内容。

## 浏览器存储

- Cookies
  - 大小为 4K 左右
  - 每个域名下限制 20 个左右
  - 会随请求发送到服务器
- LocalStorage
  - 大小为 5M 左右
  - 永久存储，除非手动清除
  - 不会随请求发送到服务器
- SessionStorage
  - 大小为 5M 左右
  - 临时存储，仅在当前会话下有效，关闭页面或浏览器后即被清除
  - 不会随请求发送到服务器

## WebSocket

WebSocket 是 H5 新增的，用于实现浏览器与服务器之间的通信功能。

特点：异步操作、事件驱动、能够实现真正意义上的推送功能  
缺点：少部分浏览器不支持

## 跨域方案

- jsonp
- nginx
- CORS
- vue 内置代理
- springboot 注解

## 浏览器输入 URL，按下回车后发生了什么

- DNS 解析
- 建立 TCP 连接（三次握手）
- 发送 HTTP 请求
- 服务器处理请求并返回 HTTP 报文
- 浏览器解析渲染页面
  - 解析 HTML，构建 DOM 树
  - 解析 CSS，构建 CSSOM 规则树
  - 合并 DOM 和 CSS 规则树，生成 Render 渲染树
  - 布局 Render 树，包括位置、尺寸信息等等
  - 绘制 Render 树，包括页面像素信息等等
- 断开连接（四次挥手）
